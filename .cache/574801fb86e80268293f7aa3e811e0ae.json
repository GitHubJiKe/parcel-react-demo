{"dependencies":[{"name":"babel-runtime/helpers/extends","loc":{"line":1,"column":21}},{"name":"babel-runtime/helpers/typeof","loc":{"line":2,"column":20}},{"name":"./util","loc":{"line":3,"column":70}},{"name":"./validator/","loc":{"line":4,"column":23}},{"name":"./messages","loc":{"line":5,"column":57}}],"generated":{"js":"\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}function r(e){this.rules=null,this._messages=u.messages,this.define(e)}Object.defineProperty(exports,\"__esModule\",{value:!0});var t=require(\"babel-runtime/helpers/extends\"),s=e(t),a=require(\"babel-runtime/helpers/typeof\"),i=e(a),n=require(\"./util\"),o=require(\"./validator/\"),l=e(o),u=require(\"./messages\");r.prototype={messages:function(e){return e&&(this._messages=(0,n.deepMerge)((0,u.newMessages)(),e)),this._messages},define:function(e){if(!e)throw new Error(\"Cannot configure a schema with no rules\");if(\"object\"!==(void 0===e?\"undefined\":(0,i.default)(e))||Array.isArray(e))throw new Error(\"Rules must be an object\");this.rules={};var r=void 0,t=void 0;for(r in e)e.hasOwnProperty(r)&&(t=e[r],this.rules[r]=Array.isArray(t)?t:[t])},validate:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],l=e,f=a,d=o;if(\"function\"==typeof f&&(d=f,f={}),this.rules&&0!==Object.keys(this.rules).length){if(f.messages){var c=this.messages();c===u.messages&&(c=(0,u.newMessages)()),(0,n.deepMerge)(c,f.messages),f.messages=c}else f.messages=this.messages();var p=void 0,g=void 0,v={};(f.keys||Object.keys(this.rules)).forEach(function(r){p=t.rules[r],g=l[r],p.forEach(function(a){var i=a;\"function\"==typeof i.transform&&(l===e&&(l=(0,s.default)({},l)),g=l[r]=i.transform(g)),(i=\"function\"==typeof i?{validator:i}:(0,s.default)({},i)).validator=t.getValidationMethod(i),i.field=r,i.fullField=i.fullField||r,i.type=t.getType(i),i.validator&&(v[r]=v[r]||[],v[r].push({rule:i,value:g,source:l,field:r}))})});var h={};(0,n.asyncMap)(v,f,function(e,t){function a(e,r){return(0,s.default)({},r,{fullField:l.fullField+\".\"+e})}function o(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(Array.isArray(i)||(i=[i]),i.length&&(0,n.warning)(\"async-validator:\",i),i.length&&l.message&&(i=[].concat(l.message)),i=i.map((0,n.complementError)(l)),f.first&&i.length)return h[l.field]=1,t(i);if(u){if(l.required&&!e.value)return i=l.message?[].concat(l.message).map((0,n.complementError)(l)):f.error?[f.error(l,(0,n.format)(f.messages.required,l.field))]:[],t(i);var o={};if(l.defaultField)for(var d in e.value)e.value.hasOwnProperty(d)&&(o[d]=l.defaultField);o=(0,s.default)({},o,e.rule.fields);for(var c in o)if(o.hasOwnProperty(c)){var p=Array.isArray(o[c])?o[c]:[o[c]];o[c]=p.map(a.bind(null,c))}var g=new r(o);g.messages(f.messages),e.rule.options&&(e.rule.options.messages=f.messages,e.rule.options.error=f.error),g.validate(e.value,e.rule.options||f,function(e){t(e&&e.length?i.concat(e):e)})}else t(i)}var l=e.rule,u=!(\"object\"!==l.type&&\"array\"!==l.type||\"object\"!==(0,i.default)(l.fields)&&\"object\"!==(0,i.default)(l.defaultField));u=u&&(l.required||!l.required&&e.value),l.field=e.field;var d=l.validator(l,e.value,o,e.source,f);d&&d.then&&d.then(function(){return o()},function(e){return o(e)})},function(e){!function(e){function r(e){Array.isArray(e)?a=a.concat.apply(a,e):a.push(e)}var t=void 0,s=void 0,a=[],i={};for(t=0;t<e.length;t++)r(e[t]);if(a.length)for(t=0;t<a.length;t++)i[s=a[t].field]=i[s]||[],i[s].push(a[t]);else a=null,i=null;d(a,i)}(e)})}else d&&d()},getType:function(e){if(void 0===e.type&&e.pattern instanceof RegExp&&(e.type=\"pattern\"),\"function\"!=typeof e.validator&&e.type&&!l.default.hasOwnProperty(e.type))throw new Error((0,n.format)(\"Unknown rule type %s\",e.type));return e.type||\"string\"},getValidationMethod:function(e){if(\"function\"==typeof e.validator)return e.validator;var r=Object.keys(e),t=r.indexOf(\"message\");return-1!==t&&r.splice(t,1),1===r.length&&\"required\"===r[0]?l.default.required:l.default[this.getType(e)]||!1}},r.register=function(e,r){if(\"function\"!=typeof r)throw new Error(\"Cannot register a validator by type, validator is not a function\");l.default[e]=r},r.messages=u.messages,exports.default=r;"},"hash":"b2eaebf9ba1d485e638f31978e53570f"}
{"dependencies":[{"name":"babel-runtime/helpers/classCallCheck","loc":{"line":1,"column":28}},{"name":"babel-runtime/helpers/possibleConstructorReturn","loc":{"line":2,"column":39}},{"name":"babel-runtime/helpers/inherits","loc":{"line":3,"column":22}},{"name":"babel-runtime/helpers/extends","loc":{"line":4,"column":21}},{"name":"babel-runtime/helpers/objectWithoutProperties","loc":{"line":5,"column":37}},{"name":"react","loc":{"line":6,"column":33}},{"name":"react-dom","loc":{"line":7,"column":21}},{"name":"rc-util/es/KeyCode","loc":{"line":8,"column":20}},{"name":"classnames","loc":{"line":9,"column":23}},{"name":"object-assign","loc":{"line":10,"column":19}},{"name":"rc-animate","loc":{"line":11,"column":20}},{"name":"./util","loc":{"line":13,"column":305}},{"name":"./SelectTrigger","loc":{"line":14,"column":26}},{"name":"./TreeNode","loc":{"line":15,"column":22}},{"name":"./strategies","loc":{"line":16,"column":50}},{"name":"./PropTypes","loc":{"line":17,"column":32}}],"generated":{"js":"\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}function t(){}function a(e,t){return String((0,T.getPropValue)(t,(0,T.labelCompatible)(this.props.treeNodeFilterProp))).indexOf(e)>-1}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(function(e,a){var l=t+\"-\"+a,n=e.label,o=e.value,i=e.disabled,s=e.key,u=(e.hasOwnProperty,e.selectable),c=e.children,h=e.isLeaf,f=(0,d.default)(e,[\"label\",\"value\",\"disabled\",\"key\",\"hasOwnProperty\",\"selectable\",\"children\",\"isLeaf\"]),g=(0,p.default)({value:o,title:n,key:s||o||l,disabled:i||!1,selectable:!1!==u||u},f);return c&&c.length?v.default.createElement(E.default,g,r(c,l)):v.default.createElement(E.default,(0,p.default)({},g,{isLeaf:h}))})}Object.defineProperty(exports,\"__esModule\",{value:!0});var l=require(\"babel-runtime/helpers/classCallCheck\"),n=e(l),o=require(\"babel-runtime/helpers/possibleConstructorReturn\"),i=e(o),s=require(\"babel-runtime/helpers/inherits\"),u=e(s),c=require(\"babel-runtime/helpers/extends\"),p=e(c),h=require(\"babel-runtime/helpers/objectWithoutProperties\"),d=e(h),f=require(\"react\"),v=e(f),g=require(\"react-dom\"),m=e(g),b=require(\"rc-util/es/KeyCode\"),C=e(b),y=require(\"classnames\"),S=e(y),N=require(\"object-assign\"),_=e(N),V=require(\"rc-animate\"),k=e(V),T=require(\"./util\"),D=require(\"./SelectTrigger\"),O=e(D),P=require(\"./TreeNode\"),E=e(P),w=require(\"./strategies\"),L=require(\"./PropTypes\"),I=function(e){function t(a){(0,n.default)(this,t);var r=(0,i.default)(this,e.call(this,a));M.call(r);var l=[];l=\"value\"in a?(0,T.toArray)(a.value):(0,T.toArray)(a.defaultValue),r.renderedTreeData=r.renderTreeData(),l=r.addLabelToValue(a,l),l=r.getValue(a,l,!a.inputValue||\"__strict\");var o=a.inputValue||\"\";return r.state={value:l,inputValue:o,open:a.open||a.defaultOpen,focused:!1},r}return(0,u.default)(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.autoFocus,a=e.disabled;if((0,T.isMultipleOrTags)(this.props)){var r=this.getInputDOMNode();r.value?(r.style.width=\"\",r.style.width=this.inputMirrorInstance.clientWidth+\"px\"):r.style.width=\"\"}t&&!a&&this.focus()},t.prototype.componentWillReceiveProps=function(e){if(this.renderedTreeData=this.renderTreeData(e),this._cacheTreeNodesStates=\"no\"!==this._cacheTreeNodesStates&&this._savedValue&&e.value===this._savedValue,this.props.treeData===e.treeData&&this.props.children===e.children||(this._treeNodesStates=(0,T.getTreeNodesStates)(this.renderedTreeData||e.children,this.state.value.map(function(e){return e.value}))),\"value\"in e){var t=(0,T.toArray)(e.value);t=this.addLabelToValue(e,t),t=this.getValue(e,t),this.setState({value:t})}e.inputValue!==this.props.inputValue&&this.setState({inputValue:e.inputValue}),\"open\"in e&&this.setState({open:e.open})},t.prototype.componentWillUpdate=function(e){this._savedValue&&e.value&&e.value!==this._savedValue&&e.value===this.props.value&&(this._cacheTreeNodesStates=!1,this.getValue(e,this.addLabelToValue(e,(0,T.toArray)(e.value))))},t.prototype.componentDidUpdate=function(){var e=this.state,t=this.props;if(e.open&&(0,T.isMultipleOrTags)(t)){var a=this.getInputDOMNode();a.value?(a.style.width=\"\",a.style.width=this.inputMirrorInstance.clientWidth+\"px\"):a.style.width=\"\"}},t.prototype.componentWillUnmount=function(){this.clearDelayTimer(),this.dropdownContainer&&(m.default.unmountComponentAtNode(this.dropdownContainer),document.body.removeChild(this.dropdownContainer),this.dropdownContainer=null)},t.prototype.getLabelFromNode=function(e){return(0,T.getPropValue)(e,this.props.treeNodeLabelProp)},t.prototype.getLabelFromProps=function(e,t){var a=this;if(void 0===t)return null;var r=null;return(0,T.loopAllChildren)(this.renderedTreeData||e.children,function(e){(0,T.getValuePropValue)(e)===t&&(r=a.getLabelFromNode(e))}),null===r?t:r},t.prototype.getDropdownContainer=function(){return this.dropdownContainer||(this.dropdownContainer=document.createElement(\"div\"),document.body.appendChild(this.dropdownContainer)),this.dropdownContainer},t.prototype.getSearchPlaceholderElement=function(e){var t=this.props,a=void 0;return(a=(0,T.isMultipleOrTagsOrCombobox)(t)?t.placeholder||t.searchPlaceholder:t.searchPlaceholder)?v.default.createElement(\"span\",{style:{display:e?\"none\":\"block\"},onClick:this.onPlaceholderClick,className:t.prefixCls+\"-search__field__placeholder\"},a):null},t.prototype.getInputElement=function(){var e=this.state.inputValue,t=this.props,a=t.prefixCls,r=t.disabled;return v.default.createElement(\"span\",{className:a+\"-search__field__wrap\"},v.default.createElement(\"input\",{ref:(0,T.saveRef)(this,\"inputInstance\"),onChange:this.onInputChange,onKeyDown:this.onInputKeyDown,value:e,disabled:r,className:a+\"-search__field\",role:\"textbox\"}),v.default.createElement(\"span\",{ref:(0,T.saveRef)(this,\"inputMirrorInstance\"),className:a+\"-search__field__mirror\"},e,\"Â \"),(0,T.isMultipleOrTags)(this.props)?null:this.getSearchPlaceholderElement(!!e))},t.prototype.getInputDOMNode=function(){return this.inputInstance},t.prototype.getPopupDOMNode=function(){return this.trigger.getPopupDOMNode()},t.prototype.getPopupComponentRefs=function(){return this.trigger.getPopupEleRefs()},t.prototype.getValue=function(e,t){var a=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=t,n=\"__strict\"===r||r&&(this.state&&this.state.inputValue||this.props.inputValue!==e.inputValue);if(e.treeCheckable&&(e.treeCheckStrictly||n)&&(this.halfCheckedValues=[],l=[],t.forEach(function(e){e.halfChecked?a.halfCheckedValues.push(e):l.push(e)})),!e.treeCheckable||e.treeCheckable&&(e.treeCheckStrictly||n))return l;var o=void 0;this._cachetreeData&&this._cacheTreeNodesStates&&this._checkedNodes&&this.state&&!this.state.inputValue?this.checkedTreeNodes=o=this._checkedNodes:(this._treeNodesStates=(0,T.getTreeNodesStates)(this.renderedTreeData||e.children,l.map(function(e){return e.value})),this.checkedTreeNodes=o=this._treeNodesStates.checkedNodes);var i=function(t){return t.map(function(t){return{value:(0,T.getValuePropValue)(t.node),label:(0,T.getPropValue)(t.node,e.treeNodeLabelProp)}})},s=this.props,u=[];if(s.showCheckedStrategy===w.SHOW_ALL)u=i(o);else if(s.showCheckedStrategy===w.SHOW_PARENT){var c=(0,T.filterParentPosition)(o.map(function(e){return e.pos}));u=i(o.filter(function(e){return-1!==c.indexOf(e.pos)}))}else u=i(o.filter(function(e){return!e.node.props.children}));return u},t.prototype.getCheckedNodes=function(e,t){var a=e.checkedNodes;if(t.treeCheckStrictly||this.state.inputValue)return a;var r=e.checkedNodesPositions;if(t.showCheckedStrategy===w.SHOW_ALL)a=a;else if(t.showCheckedStrategy===w.SHOW_PARENT){var l=(0,T.filterParentPosition)(r.map(function(e){return e.pos}));a=r.filter(function(e){return-1!==l.indexOf(e.pos)}).map(function(e){return e.node})}else a=a.filter(function(e){return!e.props.children});return a},t.prototype.getDeselectedValue=function(e){var t=this.checkedTreeNodes,a=void 0;t.forEach(function(t){t.node.props.value===e&&(a=t.pos)});var r=[],l=[];t.forEach(function(e){(0,T.isPositionPrefix)(e.pos,a)||(0,T.isPositionPrefix)(a,e.pos)||(l.push(e),r.push(e.node.props.value))}),this.checkedTreeNodes=this._checkedNodes=l;var n=this.state.value.filter(function(e){return-1!==r.indexOf(e.value)});this.fireChange(n,{triggerValue:e,clear:!0})},t.prototype.setOpenState=function(e,t){var a=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.clearDelayTimer();var l=this.props;this.props.onDropdownVisibleChange(e,{documentClickClose:r})&&this.setState({open:e},function(){if(t||e)if(e||(0,T.isMultipleOrTagsOrCombobox)(l)){var r=a.getInputDOMNode();r&&document.activeElement!==r&&r.focus()}else a.selection&&a.selection.focus()})},t.prototype.clearSearchInput=function(){this.getInputDOMNode().focus(),\"inputValue\"in this.props||this.setState({inputValue:\"\"})},t.prototype.addLabelToValue=function(e,t){var a=this,r=t;return this.isLabelInValue()?r.forEach(function(t,l){\"[object Object]\"===Object.prototype.toString.call(r[l])?t.label=t.label||a.getLabelFromProps(e,t.value):r[l]={value:\"\",label:\"\"}}):r=r.map(function(t){return{value:t,label:a.getLabelFromProps(e,t)}}),r},t.prototype.clearDelayTimer=function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)},t.prototype.removeSelected=function(e){var t=this.props;if(!t.disabled)if(this._cacheTreeNodesStates=\"no\",!t.treeCheckable||t.showCheckedStrategy!==w.SHOW_ALL&&t.showCheckedStrategy!==w.SHOW_PARENT||t.treeCheckStrictly||this.state.inputValue){var a=void 0,r=this.state.value.filter(function(t){return t.value===e&&(a=t.label),t.value!==e});if((0,T.isMultipleOrTags)(t)){var l=e;this.isLabelInValue()&&(l={value:e,label:a}),t.onDeselect(l)}t.treeCheckable&&this.checkedTreeNodes&&this.checkedTreeNodes.length&&(this.checkedTreeNodes=this._checkedNodes=this.checkedTreeNodes.filter(function(e){return r.some(function(t){return t.value===e.node.props.value})})),this.fireChange(r,{triggerValue:e,clear:!0})}else this.getDeselectedValue(e)},t.prototype.openIfHasChildren=function(){var e=this.props;(v.default.Children.count(e.children)||(0,T.isSingleMode)(e))&&this.setOpenState(!0)},t.prototype.fireChange=function(e,t){var a=this,r=this.props,l=e.map(function(e){return e.value}),n=this.state.value.map(function(e){return e.value});if(l.length!==n.length||!l.every(function(e,t){return n[t]===e})){var o={preValue:[].concat(this.state.value)};t&&(0,_.default)(o,t);var i=null,s=e;if(this.isLabelInValue()?this.halfCheckedValues&&this.halfCheckedValues.length&&this.halfCheckedValues.forEach(function(e){s.some(function(t){return t.value===e.value})||s.push(e)}):(i=e.map(function(e){return e.label}),s=s.map(function(e){return e.value})),r.treeCheckable&&o.clear){var u=this.renderedTreeData||r.children;o.allCheckedNodes=(0,T.flatToHierarchy)((0,T.filterAllCheckedData)(l,u))}if(r.treeCheckable&&this.state.inputValue){var c=[].concat(this.state.value);if(o.checked)e.forEach(function(e){c.every(function(t){return t.value!==e.value})&&c.push((0,p.default)({},e))});else{var h=void 0;c.some(function(e,t){if(e.value===o.triggerValue)return h=t,!0})&&c.splice(h,1)}s=c,this.isLabelInValue()||(i=c.map(function(e){return e.label}),s=c.map(function(e){return e.value}))}this._savedValue=(0,T.isMultipleOrTags)(r)?s:s[0],r.onChange(this._savedValue,i,o),\"value\"in r||(this._cacheTreeNodesStates=!1,this.setState({value:this.getValue(r,(0,T.toArray)(this._savedValue).map(function(e,t){return a.isLabelInValue()?e:{value:e,label:i&&i[t]}}))}))}},t.prototype.isLabelInValue=function(){var e=this.props,t=e.treeCheckable,a=e.treeCheckStrictly,r=e.labelInValue;return!(!t||!a)||(r||!1)},t.prototype.focus=function(){(0,T.isSingleMode)(this.props)?this.selection.focus():this.getInputDOMNode().focus()},t.prototype.blur=function(){(0,T.isSingleMode)(this.props)?this.selection.blur():this.getInputDOMNode().blur()},t.prototype.renderTopControlNode=function(){var e=this,t=this.state.value,a=this.props,r=a.choiceTransitionName,l=a.prefixCls,n=a.maxTagTextLength;if((0,T.isSingleMode)(a)){var o=v.default.createElement(\"span\",{key:\"placeholder\",className:l+\"-selection__placeholder\"},a.placeholder);return t.length&&(o=v.default.createElement(\"span\",{key:\"value\",title:t[0].label,className:l+\"-selection-selected-value\"},t[0].label)),v.default.createElement(\"span\",{className:l+\"-selection__rendered\"},o)}var i=[];(0,T.isMultipleOrTags)(a)&&(i=t.map(function(t){var a=t.label,r=a;return n&&\"string\"==typeof a&&a.length>n&&(a=a.slice(0,n)+\"...\"),v.default.createElement(\"li\",(0,p.default)({style:T.UNSELECTABLE_STYLE},T.UNSELECTABLE_ATTRIBUTE,{onMouseDown:T.preventDefaultEvent,className:l+\"-selection__choice\",key:t.value,title:r}),v.default.createElement(\"span\",{className:l+\"-selection__choice__remove\",onClick:e.removeSelected.bind(e,t.value)}),v.default.createElement(\"span\",{className:l+\"-selection__choice__content\"},a))})),i.push(v.default.createElement(\"li\",{className:l+\"-search \"+l+\"-search--inline\",key:\"__input\"},this.getInputElement()));var s=l+\"-selection__rendered\";return(0,T.isMultipleOrTags)(a)&&r?v.default.createElement(k.default,{className:s,component:\"ul\",transitionName:r,onLeave:this.onChoiceAnimationLeave},i):v.default.createElement(\"ul\",{className:s},i)},t.prototype.renderTreeData=function(e){var t=e||this.props;if(t.treeData){if(e&&e.treeData===this.props.treeData&&this.renderedTreeData)return this._cachetreeData=!0,this.renderedTreeData;this._cachetreeData=!1;var a=[].concat(t.treeData);if(t.treeDataSimpleMode){var l={id:\"id\",pId:\"pId\",rootPId:null};\"[object Object]\"===Object.prototype.toString.call(t.treeDataSimpleMode)&&(0,_.default)(l,t.treeDataSimpleMode),a=(0,T.processSimpleTreeData)(a,l)}return r(a)}},t.prototype.render=function(){var e,t=this.props,a=(0,T.isMultipleOrTags)(t),r=this.state,l=t.className,n=t.disabled,o=t.allowClear,i=t.prefixCls,s=this.renderTopControlNode(),u={};(0,T.isMultipleOrTagsOrCombobox)(t)||(u={onKeyDown:this.onKeyDown,tabIndex:0});var c=(e={},e[l]=!!l,e[i]=1,e[i+\"-open\"]=r.open,e[i+\"-focused\"]=r.open||r.focused,e[i+\"-disabled\"]=n,e[i+\"-enabled\"]=!n,e[i+\"-allow-clear\"]=!!t.allowClear,e),h=v.default.createElement(\"span\",{key:\"clear\",className:i+\"-selection__clear\",onClick:this.onClearSelection});return v.default.createElement(O.default,(0,p.default)({},t,{treeNodes:t.children,treeData:this.renderedTreeData,_cachetreeData:this._cachetreeData,_treeNodesStates:this._treeNodesStates,halfCheckedValues:this.halfCheckedValues,multiple:a,disabled:n,visible:r.open,inputValue:r.inputValue,inputElement:this.getInputElement(),value:r.value,onDropdownVisibleChange:this.onDropdownVisibleChange,getPopupContainer:t.getPopupContainer,onSelect:this.onSelect,ref:(0,T.saveRef)(this,\"trigger\")}),v.default.createElement(\"span\",{style:t.style,onClick:t.onClick,className:(0,S.default)(c),onBlur:t.onBlur,onFocus:t.onFocus},v.default.createElement(\"span\",(0,p.default)({ref:(0,T.saveRef)(this,\"selection\"),key:\"selection\",className:i+\"-selection\\n            \"+i+\"-selection--\"+(a?\"multiple\":\"single\"),role:\"combobox\",\"aria-autocomplete\":\"list\",\"aria-haspopup\":\"true\",\"aria-expanded\":r.open},u),s,o&&this.state.value.length&&this.state.value[0].value?h:null,a||!t.showArrow?null:v.default.createElement(\"span\",{key:\"arrow\",className:i+\"-arrow\",style:{outline:\"none\"}},v.default.createElement(\"b\",null)),a?this.getSearchPlaceholderElement(!!this.state.inputValue||this.state.value.length):null)))},t}(f.Component);I.propTypes=L.SelectPropTypes,I.defaultProps={prefixCls:\"rc-tree-select\",filterTreeNode:a,showSearch:!0,allowClear:!1,placeholder:\"\",searchPlaceholder:\"\",labelInValue:!1,onClick:t,onChange:t,onSelect:t,onDeselect:t,onSearch:t,showArrow:!0,dropdownMatchSelectWidth:!0,dropdownStyle:{},onDropdownVisibleChange:function(){return!0},notFoundContent:\"Not Found\",showCheckedStrategy:w.SHOW_CHILD,treeCheckStrictly:!1,treeIcon:!1,treeLine:!1,treeDataSimpleMode:!1,treeDefaultExpandAll:!1,treeCheckable:!1,treeNodeFilterProp:\"value\",treeNodeLabelProp:\"title\"};var M=function(){var e=this;this.onInputChange=function(t){var a=t.target.value,r=e.props;e.setState({inputValue:a,open:!0}),r.treeCheckable&&!a&&e.setState({value:e.getValue(r,[].concat(e.state.value),!1)}),r.onSearch(a)},this.onDropdownVisibleChange=function(t){!t&&(document.activeElement,e.getInputDOMNode()),setTimeout(function(){e.setOpenState(t,void 0,!t)},10)},this.onKeyDown=function(t){if(!e.props.disabled){var a=t.keyCode;e.state.open&&!e.getInputDOMNode()?e.onInputKeyDown(t):a!==C.default.ENTER&&a!==C.default.DOWN||(e.setOpenState(!0),t.preventDefault())}},this.onInputKeyDown=function(t){var a=e.props;if(!a.disabled){var r=e.state,l=t.keyCode;if(!(0,T.isMultipleOrTags)(a)||t.target.value||l!==C.default.BACKSPACE){if(l===C.default.DOWN){if(!r.open)return e.openIfHasChildren(),t.preventDefault(),void t.stopPropagation()}else if(l===C.default.ESC)return void(r.open&&(e.setOpenState(!1),t.preventDefault(),t.stopPropagation()))}else{var n=r.value.concat();if(n.length){var o=n.pop();e.removeSelected(e.isLabelInValue()?o:o.value)}}}},this.onSelect=function(t,a){if(!1!==a.selected){var r=a.node,l=e.state.value,n=e.props,o=(0,T.getValuePropValue)(r),i=e.getLabelFromNode(r),s=o;e.isLabelInValue()&&(s={value:s,label:i}),n.onSelect(s,r,a);var u=\"check\"===a.event;if((0,T.isMultipleOrTags)(n))if(e.clearSearchInput(),u)l=e.getCheckedNodes(a,n).map(function(t){return{value:(0,T.getValuePropValue)(t),label:e.getLabelFromNode(t)}});else{if(l.some(function(e){return e.value===o}))return;l=l.concat([{value:o,label:i}])}else{if(l.length&&l[0].value===o)return void e.setOpenState(!1);l=[{value:o,label:i}],e.setOpenState(!1)}var c={triggerValue:o,triggerNode:r};if(u){c.checked=a.checked,c.allCheckedNodes=n.treeCheckStrictly||e.state.inputValue?a.checkedNodes:(0,T.flatToHierarchy)(a.checkedNodesPositions),e._checkedNodes=a.checkedNodesPositions;var p=e.trigger.popupEle;e._treeNodesStates=p.checkKeys}else c.selected=a.selected;e.fireChange(l,c),null===n.inputValue&&e.setState({inputValue:\"\"})}else e.onDeselect(a)},this.onDeselect=function(t){e.removeSelected((0,T.getValuePropValue)(t.node)),(0,T.isMultipleOrTags)(e.props)?e.clearSearchInput():e.setOpenState(!1)},this.onPlaceholderClick=function(){e.getInputDOMNode().focus()},this.onClearSelection=function(t){var a=e.props,r=e.state;a.disabled||(t.stopPropagation(),e._cacheTreeNodesStates=\"no\",e._checkedNodes=[],(r.inputValue||r.value.length)&&(e.setOpenState(!1),void 0===a.inputValue?e.setState({inputValue:\"\"},function(){e.fireChange([])}):e.fireChange([])))},this.onChoiceAnimationLeave=function(){e.trigger.trigger.forcePopupAlign()}};I.SHOW_ALL=w.SHOW_ALL,I.SHOW_PARENT=w.SHOW_PARENT,I.SHOW_CHILD=w.SHOW_CHILD,exports.default=I;"},"hash":"70b1bdfb18e36c3599b8a4a74c44b538"}
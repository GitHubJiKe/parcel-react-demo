{"dependencies":[{"name":"babel-runtime/helpers/extends","loc":{"line":1,"column":21}},{"name":"babel-runtime/helpers/classCallCheck","loc":{"line":2,"column":28}},{"name":"babel-runtime/helpers/possibleConstructorReturn","loc":{"line":3,"column":39}},{"name":"babel-runtime/helpers/inherits","loc":{"line":4,"column":22}},{"name":"react","loc":{"line":5,"column":18}},{"name":"react-dom","loc":{"line":6,"column":21}},{"name":"prop-types","loc":{"line":7,"column":22}},{"name":"draft-js/lib/DraftOffsetKey","loc":{"line":8,"column":23}},{"name":"rc-animate","loc":{"line":9,"column":20}},{"name":"classnames","loc":{"line":11,"column":15}},{"name":"dom-scroll-into-view","loc":{"line":12,"column":27}},{"name":"./Nav.react","loc":{"line":14,"column":16}},{"name":"./SuggestionWrapper.react","loc":{"line":15,"column":29}},{"name":"../utils/insertMention","loc":{"line":17,"column":26}},{"name":"../utils/clearMention","loc":{"line":18,"column":25}},{"name":"../utils/getOffset","loc":{"line":19,"column":22}},{"name":"../utils/getMentions","loc":{"line":20,"column":24}},{"name":"../utils/getSearchWord","loc":{"line":21,"column":26}}],"generated":{"js":"\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,\"__esModule\",{value:!0});var t=require(\"babel-runtime/helpers/extends\"),n=e(t),o=require(\"babel-runtime/helpers/classCallCheck\"),r=e(o),s=require(\"babel-runtime/helpers/possibleConstructorReturn\"),a=e(s),i=require(\"babel-runtime/helpers/inherits\"),l=e(i),u=require(\"react\"),p=e(u),c=require(\"react-dom\"),f=e(c),d=require(\"prop-types\"),g=e(d),h=require(\"draft-js/lib/DraftOffsetKey\"),v=require(\"rc-animate\"),m=e(v),y=require(\"classnames\"),S=e(y),b=require(\"dom-scroll-into-view\"),w=e(b),D=require(\"./Nav.react\"),C=e(D),k=require(\"./SuggestionWrapper.react\"),x=e(k),q=require(\"../utils/insertMention\"),E=e(q),O=require(\"../utils/clearMention\"),M=e(O),K=require(\"../utils/getOffset\"),I=e(K),N=require(\"../utils/getMentions\"),R=e(N),A=require(\"../utils/getSearchWord\"),B=e(A),F=function(e){return!1!==e},H=function(e){function t(){(0,r.default)(this,t);var n=(0,a.default)(this,e.call(this));return n.onEditorStateChange=function(e){var t=n.props.store.getOffset();if(0===t.size)return n.closeDropDown(),e;var o=e.getSelection();if(!n.props.callbacks.getEditorState().getSelection().getHasFocus()&&o.getHasFocus())return e;var r=(0,B.default)(e,o).word;if(!r)return n.closeDropDown(),e;var s=t.map(function(t){var n=t.offsetKey,s=(0,h.decode)(n),a=s.blockKey,i=s.decoratorKey,l=s.leafKey;if(a!==o.anchorKey)return!1;var u=e.getBlockTree(a).getIn([i,\"leaves\",l]);if(!u)return!1;var p=u.get(\"start\"),c=u.get(\"end\");return!!r&&(p===c-1?o.anchorOffset>=p+1&&o.anchorOffset<=c&&n:o.anchorOffset>p+1&&o.anchorOffset<=c&&n)}),a=s.some(F);n.activeOffsetKey=s.find(F);var i=n.props.store.getTrigger(n.activeOffsetKey);if(!a||!o.getHasFocus())return n.closeDropDown(),e;var l=r.substring(i.length,r.length);return n.lastSearchValue===l&&n.lastTrigger===i||(n.lastSearchValue=l,n.lastTrigger=i,n.props.onSearchChange(l,i)),n.state.active||i&&-1===r.indexOf(i)||n.openDropDown(),e},n.onUpArrow=function(e){if(e.preventDefault(),n.props.suggestions.length>0){var t=n.state.focusedIndex-1;n.setState({focusedIndex:Math.max(t,0)})}},n.onBlur=function(e){e.preventDefault(),n.closeDropDown()},n.onDownArrow=function(e){e.preventDefault();var t=n.state.focusedIndex+1;n.setState({focusedIndex:t>=n.props.suggestions.length?0:t})},n.getContainer=function(){var e=document.createElement(\"div\"),t=void 0;return n.props.getSuggestionContainer?(t=n.props.getSuggestionContainer(),e.style.position=\"relative\"):t=document.body,t.appendChild(e),e},n.handleKeyBinding=function(e){return\"split-block\"===e},n.handleReturn=function(e){e.preventDefault();var t=n.props.suggestions[n.state.focusedIndex];return!!t&&(p.default.isValidElement(t)?n.onMentionSelect(t.props.value,t.props.data):n.onMentionSelect(t),n.lastSearchValue=null,n.lastTrigger=null,!0)},n.renderReady=function(){var e=n.dropdownContainer;if(e){var t=n.state.active,o=n.activeOffsetKey,r=n.props.store.getOffset().get(o);if(t&&r){var s=n.props.placement,a=n.getPositionStyle(!0,r.position()),i=parseFloat(a.top)-window.scrollY-e.offsetHeight<0,l=(window.innerHeight||document.documentElement.clientHeight)-(parseFloat(a.top)-window.scrollY)-e.offsetHeight<0;\"top\"!==s||i||(a.top=(parseFloat(a.top)-e.offsetHeight||0)+\"px\"),\"bottom\"===s&&l&&!i&&(a.top=(parseFloat(a.top)-e.offsetHeight||0)+\"px\"),Object.keys(a).forEach(function(t){e.style[t]=a[t]})}n.focusItem&&(0,w.default)(f.default.findDOMNode(n.focusItem),e,{onlyScrollIfNeeded:!0})}},n.getNavigations=function(){var e=n.props,t=e.prefixCls,o=e.suggestions,r=n.state.focusedIndex;return o.length?p.default.Children.map(o,function(e,o){var s=o===r,a=s?function(e){n.focusItem=e}:null,i=(0,S.default)(t+\"-dropdown-item\",{focus:s});return p.default.isValidElement(e)?p.default.cloneElement(e,{className:i,onMouseDown:function(){return n.onMentionSelect(e.props.value,e.props.data)},ref:a}):p.default.createElement(C.default,{ref:a,className:i,onMouseDown:function(){return n.onMentionSelect(e)}},e)},n):p.default.createElement(\"div\",{className:t+\"-dropdown-notfound \"+t+\"-dropdown-item\"},n.props.notFoundContent)},n.state={isActive:!1,focusedIndex:0,container:!1},n}return(0,l.default)(t,e),t.prototype.componentDidMount=function(){this.props.callbacks.onChange=this.onEditorStateChange},t.prototype.componentWillReceiveProps=function(e){e.suggestions.length!==this.props.suggestions.length&&this.setState({focusedIndex:0})},t.prototype.onMentionSelect=function(e,t){var n=this.props.callbacks.getEditorState(),o=this.props,r=o.store,s=o.onSelect,a=r.getTrigger(this.activeOffsetKey);if(s&&s(e,t||e),this.props.noRedup){if(-1!==(0,R.default)(n.getCurrentContent(),a).indexOf(\"\"+a+e))return this.closeDropDown(),void this.props.callbacks.setEditorState((0,M.default)(n))}this.props.callbacks.setEditorState((0,E.default)(n,\"\"+a+e,t,this.props.mode),!0),this.closeDropDown()},t.prototype.getPositionStyle=function(e,t){if(this.props.getSuggestionStyle)return this.props.getSuggestionStyle(e,t);var o=this.props.getSuggestionContainer?this.state.container:document.body,r=(0,I.default)(o);return t?(0,n.default)({position:\"absolute\",left:t.left-r.left+\"px\",top:t.top-r.top+\"px\"},this.props.style):{}},t.prototype.openDropDown=function(){this.props.callbacks.onUpArrow=this.onUpArrow,this.props.callbacks.handleReturn=this.handleReturn,this.props.callbacks.handleKeyBinding=this.handleKeyBinding,this.props.callbacks.onDownArrow=this.onDownArrow,this.props.callbacks.onBlur=this.onBlur,this.setState({active:!0,container:this.state.container||this.getContainer()})},t.prototype.closeDropDown=function(){this.props.callbacks.onUpArrow=null,this.props.callbacks.handleReturn=null,this.props.callbacks.handleKeyBinding=null,this.props.callbacks.onDownArrow=null,this.props.callbacks.onBlur=null,this.setState({active:!1})},t.prototype.render=function(){var e,t=this,o=this.props,r=o.prefixCls,s=o.className,a=o.placement,i=this.state,l=i.container,u=i.active,c=(0,S.default)((0,n.default)((e={},e[r+\"-dropdown\"]=!0,e[r+\"-dropdown-placement-\"+a]=!0,e),s)),f=\"top\"===a?\"slide-down\":\"slide-up\",d=this.getNavigations();return l?p.default.createElement(x.default,{renderReady:this.renderReady,container:l},p.default.createElement(m.default,{transitionName:f},u?p.default.createElement(\"div\",{className:c,ref:function(e){t.dropdownContainer=e}},d):null)):null},t}(p.default.Component);exports.default=H,H.propTypes={callbacks:g.default.object,suggestions:g.default.array,store:g.default.object,onSearchChange:g.default.func,prefixCls:g.default.string,mode:g.default.string,style:g.default.object,onSelect:g.default.func,getSuggestionContainer:g.default.func,notFoundContent:g.default.any,getSuggestionStyle:g.default.func,className:g.default.string,noRedup:g.default.bool,placement:g.default.string};"},"hash":"903f33a863c93e5b707798392f0c0438"}
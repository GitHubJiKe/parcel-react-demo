{"dependencies":[{"name":"object-assign","loc":{"line":15,"column":22}},{"name":"./BlockTree","loc":{"line":21,"column":24}},{"name":"./ContentState","loc":{"line":22,"column":27}},{"name":"./EditorBidiService","loc":{"line":23,"column":32}},{"name":"immutable","loc":{"line":24,"column":24}},{"name":"./SelectionState","loc":{"line":25,"column":29}}],"generated":{"js":"\"use strict\";function e(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function t(e,t,n){return k.set(e,{selection:t,forceSelection:n,nativelyRenderedContent:null,inlineStyleOverride:null})}function n(e,t){return e.getBlockMap().map(function(n){return s.generate(e,n,t)}).toOrderedMap()}function r(e,t,n,r){var o=e.getCurrentContent().set(\"entityMap\",n),i=o.getBlockMap();return e.getImmutable().get(\"treeMap\").merge(t.toSeq().filter(function(e,t){return e!==i.get(t)}).map(function(e){return s.generate(o,e,r)}))}function o(e,t,n,r,o){return n.merge(t.toSeq().filter(function(t){return r.getDecorations(t,e)!==o.getDecorations(t,e)}).map(function(t){return s.generate(e,t,r)}))}function i(e,t){return t!==e.getLastChangeType()||\"insert-characters\"!==t&&\"backspace-character\"!==t&&\"delete-character\"!==t}function c(e,t){var n=t.getStartKey(),r=t.getStartOffset(),o=e.getBlockForKey(n);return r>0?o.getInlineStyleAt(r-1):o.getLength()?o.getInlineStyleAt(0):u(e,n)}function a(e,t){var n=t.getStartKey(),r=t.getStartOffset(),o=e.getBlockForKey(n);return r<o.getLength()?o.getInlineStyleAt(r):r>0?o.getInlineStyleAt(r-1):u(e,n)}function u(e,t){var n=e.getBlockMap().reverse().skipUntil(function(e,n){return n===t}).skip(1).skipUntil(function(e,t){return e.getLength()}).first();return n?n.getInlineStyleAt(n.getLength()-1):y()}var l=require(\"object-assign\"),g=l||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=require(\"./BlockTree\"),p=require(\"./ContentState\"),f=require(\"./EditorBidiService\"),d=require(\"immutable\"),S=require(\"./SelectionState\"),y=d.OrderedSet,h=d.Record,C=d.Stack,m={allowUndo:!0,currentContent:null,decorator:null,directionMap:null,forceSelection:!1,inCompositionMode:!1,inlineStyleOverride:null,lastChangeType:null,nativelyRenderedContent:null,redoStack:C(),selection:null,treeMap:null,undoStack:C()},v=h(m),k=function(){function u(t){e(this,u),this._immutable=t}return u.createEmpty=function(e){return u.createWithContent(p.createFromText(\"\"),e)},u.createWithContent=function(e,t){var n=e.getBlockMap().first().getKey();return u.create({currentContent:e,undoStack:C(),redoStack:C(),decorator:t||null,selection:S.createEmpty(n)})},u.create=function(e){var t=e.currentContent,r=e.decorator,o=g({},e,{treeMap:n(t,r),directionMap:f.getDirectionMap(t)});return new u(new v(o))},u.set=function(e,t){return new u(e.getImmutable().withMutations(function(i){var c=i.get(\"decorator\"),a=c;null===t.decorator?a=null:t.decorator&&(a=t.decorator);var u=t.currentContent||e.getCurrentContent();if(a!==c){var l,g=i.get(\"treeMap\");return l=a&&c?o(u,u.getBlockMap(),g,a,c):n(u,a),void i.merge({decorator:a,treeMap:l,nativelyRenderedContent:null})}u!==e.getCurrentContent()&&i.set(\"treeMap\",r(e,u.getBlockMap(),u.getEntityMap(),a)),i.merge(t)}))},u.prototype.toJS=function(){return this.getImmutable().toJS()},u.prototype.getAllowUndo=function(){return this.getImmutable().get(\"allowUndo\")},u.prototype.getCurrentContent=function(){return this.getImmutable().get(\"currentContent\")},u.prototype.getUndoStack=function(){return this.getImmutable().get(\"undoStack\")},u.prototype.getRedoStack=function(){return this.getImmutable().get(\"redoStack\")},u.prototype.getSelection=function(){return this.getImmutable().get(\"selection\")},u.prototype.getDecorator=function(){return this.getImmutable().get(\"decorator\")},u.prototype.isInCompositionMode=function(){return this.getImmutable().get(\"inCompositionMode\")},u.prototype.mustForceSelection=function(){return this.getImmutable().get(\"forceSelection\")},u.prototype.getNativelyRenderedContent=function(){return this.getImmutable().get(\"nativelyRenderedContent\")},u.prototype.getLastChangeType=function(){return this.getImmutable().get(\"lastChangeType\")},u.prototype.getInlineStyleOverride=function(){return this.getImmutable().get(\"inlineStyleOverride\")},u.setInlineStyleOverride=function(e,t){return u.set(e,{inlineStyleOverride:t})},u.prototype.getCurrentInlineStyle=function(){var e=this.getInlineStyleOverride();if(null!=e)return e;var t=this.getCurrentContent(),n=this.getSelection();return n.isCollapsed()?c(t,n):a(t,n)},u.prototype.getBlockTree=function(e){return this.getImmutable().getIn([\"treeMap\",e])},u.prototype.isSelectionAtStartOfContent=function(){var e=this.getCurrentContent().getBlockMap().first().getKey();return this.getSelection().hasEdgeWithin(e,0,0)},u.prototype.isSelectionAtEndOfContent=function(){var e=this.getCurrentContent().getBlockMap().last(),t=e.getLength();return this.getSelection().hasEdgeWithin(e.getKey(),t,t)},u.prototype.getDirectionMap=function(){return this.getImmutable().get(\"directionMap\")},u.acceptSelection=function(e,n){return t(e,n,!1)},u.forceSelection=function(e,n){return n.getHasFocus()||(n=n.set(\"hasFocus\",!0)),t(e,n,!0)},u.moveSelectionToEnd=function(e){var t=e.getCurrentContent().getLastBlock(),n=t.getKey(),r=t.getLength();return u.acceptSelection(e,new S({anchorKey:n,anchorOffset:r,focusKey:n,focusOffset:r,isBackward:!1}))},u.moveFocusToEnd=function(e){var t=u.moveSelectionToEnd(e);return u.forceSelection(t,t.getSelection())},u.push=function(e,t,n){if(e.getCurrentContent()===t)return e;var r=\"insert-characters\"!==n,o=f.getDirectionMap(t,e.getDirectionMap());if(!e.getAllowUndo())return u.set(e,{currentContent:t,directionMap:o,lastChangeType:n,selection:t.getSelectionAfter(),forceSelection:r,inlineStyleOverride:null});var c=e.getSelection(),a=e.getCurrentContent(),l=e.getUndoStack(),g=t;c!==a.getSelectionAfter()||i(e,n)?(l=l.push(a),g=g.set(\"selectionBefore\",c)):\"insert-characters\"!==n&&\"backspace-character\"!==n&&\"delete-character\"!==n||(g=g.set(\"selectionBefore\",a.getSelectionBefore()));var s=e.getInlineStyleOverride();-1===[\"adjust-depth\",\"change-block-type\",\"split-block\"].indexOf(n)&&(s=null);var p={currentContent:g,directionMap:o,undoStack:l,redoStack:C(),lastChangeType:n,selection:t.getSelectionAfter(),forceSelection:r,inlineStyleOverride:s};return u.set(e,p)},u.undo=function(e){if(!e.getAllowUndo())return e;var t=e.getUndoStack(),n=t.peek();if(!n)return e;var r=e.getCurrentContent(),o=f.getDirectionMap(n,e.getDirectionMap());return u.set(e,{currentContent:n,directionMap:o,undoStack:t.shift(),redoStack:e.getRedoStack().push(r),forceSelection:!0,inlineStyleOverride:null,lastChangeType:\"undo\",nativelyRenderedContent:null,selection:r.getSelectionBefore()})},u.redo=function(e){if(!e.getAllowUndo())return e;var t=e.getRedoStack(),n=t.peek();if(!n)return e;var r=e.getCurrentContent(),o=f.getDirectionMap(n,e.getDirectionMap());return u.set(e,{currentContent:n,directionMap:o,undoStack:e.getUndoStack().push(r),redoStack:t.shift(),forceSelection:!0,inlineStyleOverride:null,lastChangeType:\"redo\",nativelyRenderedContent:null,selection:n.getSelectionAfter()})},u.prototype.getImmutable=function(){return this._immutable},u}();module.exports=k;"},"hash":"2886d82442df03e3e048a40fabae32f7"}
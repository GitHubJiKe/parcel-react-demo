{"dependencies":[{"name":"react","loc":{"line":9,"column":18}},{"name":"prop-types","loc":{"line":10,"column":22}},{"name":"draft-js","loc":{"line":11,"column":146}},{"name":"immutable","loc":{"line":12,"column":26}},{"name":"setimmediate","loc":{"line":13,"column":7}},{"name":"../Toolbar","loc":{"line":14,"column":30}},{"name":"./ConfigStore","loc":{"line":15,"column":24}},{"name":"./export/getHTML","loc":{"line":16,"column":20}},{"name":"./export/exportText","loc":{"line":17,"column":42}},{"name":"./customHTML2Content","loc":{"line":18,"column":31}}],"generated":{"js":"\"use strict\";function t(t){return t&&t.__esModule?t:{default:t}}function e(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function o(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!==(void 0===e?\"undefined\":i(e))&&\"function\"!=typeof e?t:e}function r(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+(void 0===e?\"undefined\":i(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(){}Object.defineProperty(exports,\"__esModule\",{value:!0});var i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},a=require(\"react\"),s=t(a),l=require(\"prop-types\"),u=t(l),c=require(\"draft-js\"),d=require(\"immutable\");require(\"setimmediate\");var p=require(\"../Toolbar\"),f=require(\"./ConfigStore\"),h=t(f),y=require(\"./export/getHTML\"),m=t(y),g=require(\"./export/exportText\"),S=t(g),v=require(\"./customHTML2Content\"),b=t(v),E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},C=c.KeyBindingUtil.hasCommandModifier,M={},P={width:0,opacity:0,border:0,position:\"absolute\",left:0,top:0},k=(0,p.createToolbar)(),F=new h.default,w=function(t){function i(r){e(this,i);var n=o(this,t.call(this,r));n.cancelForceUpdateImmediate=function(){clearImmediate(n.forceUpdateImmediate),n.forceUpdateImmediate=null},n.handlePastedText=function(t,e){var o=n.state.editorState;if(e){var r=o.getCurrentContent(),i=o.getSelection(),a=(0,b.default)(e,r),s=c.Modifier.replaceWithFragment(r,i,a),l=s.merge({selectionBefore:i,selectionAfter:s.getSelectionAfter().set(\"hasFocus\",!0)});return n.setEditorState(c.EditorState.push(o,l,\"insert-fragment\"),!0),\"handled\"}return\"not-handled\"},n.plugins=(0,d.List)((0,d.List)(r.plugins).flatten(!0));var a=void 0;return a=void 0!==r.value&&r.value instanceof c.EditorState?r.value||c.EditorState.createEmpty():c.EditorState.createEmpty(),a=n.generatorDefaultValue(a),n.state={plugins:n.reloadPlugins(),editorState:a,customStyleMap:{},customBlockStyleMap:{},compositeDecorator:null},void 0!==r.value&&(n.controlledMode=!0),n}return r(i,t),i.ToEditorState=function(t){var e=c.ContentState.createFromText((0,g.decodeContent)(t)||\"\"),o=c.EditorState.createWithContent(e);return c.EditorState.forceSelection(o,e.getSelectionAfter())},i.prototype.Reset=function(){var t=this.props.defaultValue,e=t?t.getCurrentContent():c.ContentState.createFromText(\"\"),o=c.EditorState.push(this.state.editorState,e,\"remove-range\");this.setEditorState(c.EditorState.forceSelection(o,e.getSelectionBefore()))},i.prototype.SetText=function(t){var e=c.ContentState.createFromText(t||\"\"),o=c.EditorState.push(this.state.editorState,e,\"change-block-data\");this.setEditorState(c.EditorState.moveFocusToEnd(o),!0)},i.prototype.getChildContext=function(){return{getEditorState:this.getEditorState,setEditorState:this.setEditorState}},i.prototype.reloadPlugins=function(){var t=this;return this.plugins&&this.plugins.size?this.plugins.map(function(e){if(e.callbacks)return e;if(e.hasOwnProperty(\"constructor\")){var o=E(t.props.pluginConfig,e.config||{},M);return e.constructor(o)}return!1}).filter(function(t){return t}).toArray():[]},i.prototype.componentWillMount=function(){var t=this.initPlugins().concat([k]),e={},o={},r=(0,d.Map)(c.DefaultDraftBlockRenderMap),n=(0,d.List)([]),i=new c.CompositeDecorator(t.filter(function(t){return void 0!==t.decorators}).map(function(t){return t.decorators}).reduce(function(t,e){return t.concat(e)},[])),a=(0,d.List)(t.filter(function(t){return!!t.component&&\"toolbar\"!==t.name}));t.forEach(function(t){var i=t.styleMap,a=t.blockStyleMap,s=t.blockRenderMap,l=t.toHtml;if(i)for(var u in i)i.hasOwnProperty(u)&&(e[u]=i[u]);if(a)for(var c in a)a.hasOwnProperty(c)&&(o[c]=a[c],r=r.set(c,{element:null}));if(l&&(n=n.push(l)),s)for(var d in s)s.hasOwnProperty(d)&&(r=r.set(d,s[d]))}),F.set(\"customStyleMap\",e),F.set(\"customBlockStyleMap\",o),F.set(\"blockRenderMap\",r),F.set(\"customStyleFn\",this.customStyleFn.bind(this)),F.set(\"toHTMLList\",n),this.setState({toolbarPlugins:a,compositeDecorator:i}),this.setEditorState(c.EditorState.set(this.state.editorState,{decorator:i}))},i.prototype.componentWillReceiveProps=function(t){if(this.forceUpdateImmediate&&this.cancelForceUpdateImmediate(),this.controlledMode){var e=t.value.getDecorator()?t.value:c.EditorState.set(t.value,{decorator:this.state.compositeDecorator});this.setState({editorState:e})}},i.prototype.componentWillUnmount=function(){this.cancelForceUpdateImmediate()},i.prototype.generatorDefaultValue=function(t){var e=this.props.defaultValue;return e||t},i.prototype.getStyleMap=function(){return F.get(\"customStyleMap\")},i.prototype.setStyleMap=function(t){F.set(\"customStyleMap\",t),this.render()},i.prototype.initPlugins=function(){var t=this,e=[\"focus\",\"getEditorState\",\"setEditorState\",\"getStyleMap\",\"setStyleMap\"];return this.getPlugins().map(function(o){return e.forEach(function(e){o.callbacks.hasOwnProperty(e)&&(o.callbacks[e]=t[e].bind(t))}),o})},i.prototype.focusEditor=function(t){this.refs.editor.focus(t),this.props.readOnly&&this._focusDummy.focus(),this.props.onFocus&&this.props.onFocus(t)},i.prototype.focus=function(t){var e=this;if(t&&t.nativeEvent&&t.nativeEvent.target){var o=t.nativeEvent;if(!document.activeElement||\"true\"!==document.activeElement.getAttribute(\"contenteditable\")){if(o.target===this._editorWrapper){var r=this.state.editorState,n=r.getSelection();if(!n.getHasFocus()&&n.isCollapsed())return this.setState({editorState:c.EditorState.moveFocusToEnd(r)},function(){e.focusEditor(t)})}this.focusEditor(t)}}},i.prototype.getPlugins=function(){return this.state.plugins.slice()},i.prototype.getEventHandler=function(){var t=this,e={};return[\"onUpArrow\",\"onDownArrow\",\"handleReturn\",\"onFocus\",\"onBlur\",\"onTab\",\"handlePastedText\"].forEach(function(o){e[o]=t.generatorEventHandler(o)}),e},i.prototype.getEditorState=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.refs.editor.focus(),this.state.editorState},i.prototype.setEditorState=function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t;this.getPlugins().forEach(function(t){if(t.onChange){var e=t.onChange(r);e&&(r=e)}}),this.props.onChange&&(this.props.onChange(r),this.controlledMode&&(this.forceUpdateImmediate=setImmediate(function(){return e.setState({editorState:new c.EditorState(e.state.editorState.getImmutable())})}))),this.controlledMode||this.setState({editorState:r},o?function(){return setImmediate(function(){return e.refs.editor.focus()})}:n)},i.prototype.handleKeyBinding=function(t){if(this.props.onKeyDown){t.ctrlKey=C(t);var e=this.props.onKeyDown(t);return e||(0,c.getDefaultKeyBinding)(t)}return(0,c.getDefaultKeyBinding)(t)},i.prototype.handleKeyCommand=function(t){return this.props.multiLines?this.eventHandle(\"handleKeyBinding\",t):\"split-block\"===t?\"handled\":\"not-handled\"},i.prototype.getBlockStyle=function(t){var e=F.get(\"customBlockStyleMap\"),o=t.getType();if(e.hasOwnProperty(o))return e[o]},i.prototype.blockRendererFn=function(t){var e=null;return this.getPlugins().forEach(function(o){if(o.blockRendererFn){var r=o.blockRendererFn(t);r&&(e=r)}}),e},i.prototype.eventHandle=function(t){for(var e,o=this.getPlugins(),r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0;a<o.length;a++){var s=o[a];if(s.callbacks[t]&&\"function\"==typeof s.callbacks[t]){var l;if(!0===(l=s.callbacks)[t].apply(l,n))return\"handled\"}}return this.props.hasOwnProperty(t)&&!0===(e=this.props)[t].apply(e,n)?\"handled\":\"not-handled\"},i.prototype.generatorEventHandler=function(t){var e=this;return function(){for(var o=arguments.length,r=Array(o),n=0;n<o;n++)r[n]=arguments[n];return e.eventHandle.apply(e,[t].concat(r))}},i.prototype.customStyleFn=function(t){if(0===t.size)return{};for(var e=this.getPlugins(),o={},r=0;r<e.length;r++)if(e[r].customStyleFn){var n=e[r].customStyleFn(t);n&&E(o,n)}return o},i.prototype.render=function(){var t=this,e=this.props,o=e.prefixCls,r=e.toolbars,n=e.style,i=e.readOnly,a=this.state,l=a.editorState,u=a.toolbarPlugins,d=F.get(\"customStyleMap\"),p=F.get(\"blockRenderMap\"),f=this.getEventHandler(),h=k.component;return s.default.createElement(\"div\",{style:n,className:o+\"-editor \"+(i?\"readonly\":\"\"),onClick:this.focus.bind(this)},s.default.createElement(h,{editorState:l,prefixCls:o,className:o+\"-toolbar\",plugins:u,toolbars:r}),s.default.createElement(\"div\",{className:o+\"-editor-wrapper\",ref:function(e){return t._editorWrapper=e},style:n,onClick:function(t){return t.preventDefault()}},s.default.createElement(c.Editor,E({},this.props,f,{ref:\"editor\",customStyleMap:d,customStyleFn:this.customStyleFn.bind(this),editorState:l,handleKeyCommand:this.handleKeyCommand.bind(this),keyBindingFn:this.handleKeyBinding.bind(this),onChange:this.setEditorState.bind(this),blockStyleFn:this.getBlockStyle.bind(this),blockRenderMap:p,handlePastedText:this.handlePastedText,blockRendererFn:this.blockRendererFn.bind(this)})),i?s.default.createElement(\"input\",{style:P,ref:function(e){return t._focusDummy=e},onBlur:f.onBlur}):null,this.props.children))},i}(s.default.Component);w.GetText=S.default,w.GetHTML=(0,m.default)(F),w.defaultProps={multiLines:!0,plugins:[],prefixCls:\"rc-editor-core\",pluginConfig:{},toolbars:[],spilitLine:\"enter\"},w.childContextTypes={getEditorState:u.default.func,setEditorState:u.default.func},exports.default=w;"},"hash":"3cfc9f105818ad8f0c43de2f9e7fab10"}